{"question": "\nI'm trying to construct a QNN using controlled arbitrary unitary gates. While some simple code versions work perfectly for controlled single rotations, the moment I add CU gate with parameters, the forward() method throws the exception \"Estimator job failed\".\nTrying to explore the error trace, there seems to be an issue with sympy wanting to convert a complex number to a float.\nI tried a non-controlled UGate, which works fine. I also tried UGate.control(1), but I am assuming that CU is just a wrapper for that, so not too surprisingly it doesn't work either.\nI will post a simple example below. Thank you for your help!\nimport numpy as np\nimport qiskit as q\nfrom qiskit.circuit import Parameter\nfrom qiskit.quantum_info import SparsePauliOp\nfrom qiskit_machine_learning.neural_networks import EstimatorQNN\nfrom qiskit.circuit.library import CUGate\n\nparams1 = [Parameter(\"input1\"), Parameter(\"weight1\")]\nqc1 = q.QuantumCircuit(2)\nqc1.h(0)\nqc1.ry(params1[0],0)\nqc1.append(CUGate(params1[1],0,0,0),[0,1])\nqc1.rx(params1[1], 0)\n\nobservable1 = SparsePauliOp.from_list([(\"Z\" * qc1.num_qubits, 1)])\n\nestimator_qnn = EstimatorQNN(\n    circuit=qc1, observables=observable1, input_params=[params1[0]], weight_params=[params1[1]]\n)\n\nestimator_qnn_input = np.random.random(estimator_qnn.num_inputs)\nestimator_qnn_weights = np.random.random(estimator_qnn.num_weights)\n\nestimator_qnn_forward = estimator_qnn.forward(estimator_qnn_input, estimator_qnn_weights)\n\n```\n\n", "answers": ["\nFrom what I can tell the CU gate does not have the parameter substituted correctly, as you summized. The estimator will assign the parameters in the QNN. In looking at just the circuit the parameter indeed does not get bound correctly, so I raised an issue on Qiskit https://github.com/Qiskit/qiskit-terra/issues/10131 for the developers to investigate further.\n"], "comments": [], "link": "https://quantumcomputing.stackexchange.com//questions/32647/qiskit-machine-learning-qnnestimator-estimator-job-failed-when-using-cu-gates/32653?r=SearchResults#32653"}