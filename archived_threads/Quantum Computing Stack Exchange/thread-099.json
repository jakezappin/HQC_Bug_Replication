{"question": "\nI prepared a quadratic optimization task with binary and integer variables and linear and quadratic constraints. I fed it into QuadraticProgram in Qiskit. After that, I tried to convert the program to binary optimization task with constraints in form of equality only. I used InequalityToEquality and IntegerToBinary converters to do this. However, an error was returned. After some trial and error, I realized that the problem is caused by the quadratic constraint, so I removed it and everything is fine.\nMy questions are:\n\nIs the problem really in the quadratic constraint? Or in other words, are such constraints forbidden when I want to use converters?\nIf so, is there any other way how to convert QuadraticProgram to QUBO in Qiskit?\n(note that QuadraticProgramToQubo also does not work since IntegerToBinary is part of it)\n\nHere is my code:\n%matplotlib inline\nfrom qiskit.optimization import QuadraticProgram\nfrom qiskit.optimization.converters import InequalityToEquality, IntegerToBinary, QuadraticProgramToQubo\n\n#create empty optimization task (model)\nmod = QuadraticProgram('Quadratic optimization problem') #string in brackets - user defined name of the task\n\n#adding variables\nmod.binary_var(name = 'x') #bin\nmod.integer_var(name = 'y', lowerbound = 0, upperbound = 5) \nmod.integer_var(name = 'z', lowerbound = 0, upperbound = 5) \n#setting objective function\nmod.minimize(constant = 3, linear = [1,0,1], quadratic = [[1, 0, 2],[0,1,0],[2,0,1]])\n#adding constraints\nmod.linear_constraint(linear = {'x': 1, 'y': 1, 'z':1}, sense = '==', rhs = 1, name = 'L1')\nmod.linear_constraint(linear = {'x': -1, 'y': -1, 'z':2}, sense = '>=', rhs = 0, name = 'L2')\nmod.linear_constraint(linear = {'x': 10, 'y': 20, 'z':30}, sense = '<=', rhs = 100, name = 'L3')\n\n#PROBLEMATIC QUADRATIC CONSTAINT\nmod.quadratic_constraint(linear = {'x':1, 'y':1}, quadratic = {('x','y'):1, ('x','z'):-1}, sense = '<=', rhs = 2, name = 'Q1')\n\nmodConverted = InequalityToEquality().convert(mod)\nmodConverted = IntegerToBinary().convert(modConverted)\nprint(modConverted.export_as_lp_string())\n\nAnd here is the returned error:\n---------------------------------------------------------------------------\nKeyError                                  Traceback (most recent call last)\n<ipython-input-13-f345029f5fa8> in <module>\n     20 \n     21 modConverted = InequalityToEquality().convert(mod)\n---> 22 modConverted = IntegerToBinary().convert(modConverted)\n     23 print(modConverted.export_as_lp_string())\n\n/opt/conda/lib/python3.7/site-packages/qiskit/optimization/converters/integer_to_binary.py in convert(self, problem)\n     96                         )\n     97 \n---> 98             self._substitute_int_var()\n     99 \n    100         else:\n\n/opt/conda/lib/python3.7/site-packages/qiskit/optimization/converters/integer_to_binary.py in _substitute_int_var(self)\n    199             )\n    200             quadratic, q_linear, q_constant = self._convert_quadratic_coefficients_dict(\n--> 201                 constraint.quadratic.to_dict()\n    202             )\n    203 \n\n/opt/conda/lib/python3.7/site-packages/qiskit/optimization/converters/integer_to_binary.py in _convert_quadratic_coefficients_dict(self, coefficients)\n    137         quadratic = {}\n    138         for (name_i, name_j), v in coefficients.items():\n--> 139             x = self._src.get_variable(name_i)\n    140             y = self._src.get_variable(name_j)\n    141 \n\n/opt/conda/lib/python3.7/site-packages/qiskit/optimization/problems/quadratic_program.py in get_variable(self, i)\n    243             return self.variables[i]\n    244         else:\n--> 245             return self.variables[self._variables_index[i]]\n    246 \n    247     def get_num_vars(self, vartype: Optional[VarType] = None) -> int:\n\nKeyError: 0\n```\n\n", "answers": ["\nThank you for your report.\nI investigated the details and fixed the bug with this pull request.\n"], "comments": ["Thank you for help. May I ask you to inform me when the bug is fixed?", "It's merged to master.", "This is very much needed by me, hopefully I shall get it soon. It is still happening for me though."], "link": "https://quantumcomputing.stackexchange.com//questions/13787/quadratic-optimization-in-qiskit-error-when-quadraticprogram-with-quadratic-con/13791?r=SearchResults#13791"}