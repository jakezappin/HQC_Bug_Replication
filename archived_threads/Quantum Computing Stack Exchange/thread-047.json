{"question": "\nI am trying to calculate the expectation value of a customized operator on two similar but differently constructed states \u03d5=\u03d52=12\u221a(|001\u27e9+|011\u27e9) which consist of more qubits than the operator. (via Qiskit)\nimport numpy as np\nfrom qiskit import QuantumCircuit\nfrom qiskit.aqua.operators import CircuitOp, state_fns, Zero, One\n\ncircuit = QuantumCircuit(2)\ncircuit.z(0)\ncircuit.z(1)\n\nop = CircuitOp(circuit)\n\npsi = QuantumCircuit(3)\npsi.h(1)\npsi.x(2)\npsi = state_fns.CircuitStateFn(circuit)\npsi2 = 1 / np.sqrt(2) * ((Zero ^ Zero ^ One) + (Zero ^ One ^ One))\n\n\nprint('Expectation for phi:', psi.adjoint().compose(op).compose(psi).eval().real)  # Expectation for phi: 1.0\nprint('Expectation for phi2:', psi2.adjoint().compose(op).compose(psi2).eval().real) # Error\n\n\nThe second expectation raises an error:\nValueError: Composition is not defined over Operators of different dimensions, 3 and 2, respectively.\nWhy is this happening? Why the first expectation is executed fine but not the second one?\n", "answers": ["\nFirst of all, I think there is a little mistake in the way you define psi. Indeed, you first create it as a 3-qubits circuit and then \"erase\" this by doing psi = state_fns.CircuitStateFn(circuit), meaning it will be exactly the same as the operator you defined right before, op. You can check the circuit you create via an operator using for example psi.primitive.draw() if you want to see! This is why your code worked for psi but not for psi2.\nThen, Qiskit won't do the composition of operators that don't have the same size because it is not mathematically possible with matrices. May I suggest adding a third qubit on op without adding any gates on it, this way op will have the same size as psi and psi2 and your code will run without errors since all the operators will have the same size!\nI hope this will help you :)\n"], "comments": [], "link": "https://quantumcomputing.stackexchange.com//questions/12779/expectation-value-of-an-operator-error-composition-is-not-defined-over-operator?r=SearchResults"}