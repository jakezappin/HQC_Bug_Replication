{"0": {"author": "combarro", "date": "1669889304155", "content": "Hi!\nI have noticed very different results when using VQE on PennyLane version 0.26.0 and when using it on PennyLane 0.27.0\nMy code is the following (the geometry values are just for testing):\nimport pennylane as qml\nfrom pennylane import numpy as np\n\nseed = 1234\nnp.random.seed(seed) \n\nsymbols  = ['H', 'H', 'H']\ngeometry = np.array([-0.0399, -0.0038, 0.0, 1.5780, 0.8540, 0.0, 2.7909, -0.5159, 0.0], requires_grad = False)\nelectrons = 2\ncharge = 1\n\n%time H, qubits = qml.qchem.molecular_hamiltonian(symbols, geometry, charge=charge)\n\nhf_state = qml.qchem.hf_state(electrons, qubits)\n\nsingles, doubles = qml.qchem.excitations(electrons, qubits)\n\ns_wires, d_wires = qml.qchem.excitations_to_wires(singles, doubles)\n\ndev = qml.device(\"default.qubit\", wires=qubits)\n\n@qml.qnode(dev)\ndef circuit(params, wires, s_wires, d_wires, hf_state):\n    qml.UCCSD(params, wires, s_wires, d_wires, hf_state)\n    return qml.expval(H)\n\nparams = np.random.random(len(singles) + len(doubles))\nprint(params)\n\noptimizer = qml.GradientDescentOptimizer(stepsize=0.1)\n\nfor n in range(11):\n    %time params, energy = optimizer.step_and_cost(circuit, params,wires=range(qubits), s_wires=s_wires, d_wires=d_wires, hf_state=hf_state)\n    if n % 2 == 0:\n        print(\"step = {:},  E = {:.8f} Ha\".format(n, energy))\n\nWith PennyLane 0.26 I obtain the following:\nCPU times: user 694 ms, sys: 0 ns, total: 694 ms\nWall time: 1.38 s\n[0.78535858 0.77997581 0.27259261 0.27646426 0.80187218 0.95813935\n0.87593263 0.35781727]\nCPU times: user 673 ms, sys: 0 ns, total: 673 ms\nWall time: 1.35 s\nstep = 0,  E = 0.26146914 Ha\nCPU times: user 564 ms, sys: 0 ns, total: 564 ms\nWall time: 1.12 s\nCPU times: user 688 ms, sys: 0 ns, total: 688 ms\nWall time: 1.37 s\nstep = 2,  E = 0.24324925 Ha\nCPU times: user 566 ms, sys: 0 ns, total: 566 ms\nWall time: 1.13 s\nCPU times: user 681 ms, sys: 0 ns, total: 681 ms\nWall time: 1.36 s\nstep = 4,  E = 0.22191782 Ha\nCPU times: user 697 ms, sys: 0 ns, total: 697 ms\nWall time: 1.39 s\nCPU times: user 568 ms, sys: 0 ns, total: 568 ms\nWall time: 1.14 s\nstep = 6,  E = 0.19712825 Ha\nCPU times: user 690 ms, sys: 1.68 ms, total: 692 ms\nWall time: 1.37 s\nCPU times: user 565 ms, sys: 0 ns, total: 565 ms\nWall time: 1.12 s\nstep = 8,  E = 0.16858973 Ha\nCPU times: user 690 ms, sys: 0 ns, total: 690 ms\nWall time: 1.38 s\nCPU times: user 570 ms, sys: 9.75 ms, total: 580 ms\nWall time: 1.16 s\nstep = 10,  E = 0.13611113 Ha\nWith PennyLane 0.27.0 I get this:\nCPU times: user 690 ms, sys: 10.8 ms, total: 701 ms\nWall time: 1.97 s\n[0.78535858 0.77997581 0.27259261 0.27646426 0.80187218 0.95813935\n0.87593263 0.35781727]\nCPU times: user 572 ms, sys: 2.63 ms, total: 575 ms\nWall time: 1.15 s\nstep = 0,  E = -0.73428150 Ha\nCPU times: user 672 ms, sys: 6.1 ms, total: 678 ms\nWall time: 1.37 s\nCPU times: user 566 ms, sys: 1.18 ms, total: 567 ms\nWall time: 1.13 s\nstep = 2,  E = -0.76374619 Ha\nCPU times: user 664 ms, sys: 18.3 ms, total: 682 ms\nWall time: 1.37 s\nCPU times: user 672 ms, sys: 0 ns, total: 672 ms\nWall time: 1.36 s\nstep = 4,  E = -0.79437752 Ha\nCPU times: user 564 ms, sys: 0 ns, total: 564 ms\nWall time: 1.15 s\nCPU times: user 676 ms, sys: 0 ns, total: 676 ms\nWall time: 1.36 s\nstep = 6,  E = -0.82591780 Ha\nCPU times: user 566 ms, sys: 0 ns, total: 566 ms\nWall time: 728 ms\nCPU times: user 689 ms, sys: 20.8 ms, total: 710 ms\nWall time: 1.26 s\nstep = 8,  E = -0.85804157 Ha\nCPU times: user 581 ms, sys: 1.7 ms, total: 583 ms\nWall time: 1.41 s\nCPU times: user 692 ms, sys: 5.81 ms, total: 697 ms\nWall time: 1.68 s\nstep = 10,  E = -0.89036698 Ha\nI expected to get the same results with both version. What has changed? Which is the correct one?\nThanks in advance!", "link": "https://discuss.pennylane.ai//t/different-results-with-vqe-on-versions-0-26-0-and-0-27-0/2332/1"}, "1": {"author": "Alvaro_Ballon", "date": "1670008442717", "content": "Hello combarro,\nIt does seem that PennyLane 0.27.0 is having some hiccups with optimization in some particular cases. I will consult with our team and hopefully we can give you a solution soon. For now, I would stick with 0.26.0 until we figure out what changed in 0.27.0.", "link": "https://discuss.pennylane.ai//t/different-results-with-vqe-on-versions-0-26-0-and-0-27-0/2332/2"}, "2": {"author": "combarro", "date": "1670091805816", "content": "OK, understood. I\u2019ll stick with 0.26.0, thanks.", "link": "https://discuss.pennylane.ai//t/different-results-with-vqe-on-versions-0-26-0-and-0-27-0/2332/3"}, "3": {"author": "combarro", "date": "1669889304155", "content": "Hi!\nI have noticed very different results when using VQE on PennyLane version 0.26.0 and when using it on PennyLane 0.27.0\nMy code is the following (the geometry values are just for testing):\nimport pennylane as qml\nfrom pennylane import numpy as np\n\nseed = 1234\nnp.random.seed(seed) \n\nsymbols  = ['H', 'H', 'H']\ngeometry = np.array([-0.0399, -0.0038, 0.0, 1.5780, 0.8540, 0.0, 2.7909, -0.5159, 0.0], requires_grad = False)\nelectrons = 2\ncharge = 1\n\n%time H, qubits = qml.qchem.molecular_hamiltonian(symbols, geometry, charge=charge)\n\nhf_state = qml.qchem.hf_state(electrons, qubits)\n\nsingles, doubles = qml.qchem.excitations(electrons, qubits)\n\ns_wires, d_wires = qml.qchem.excitations_to_wires(singles, doubles)\n\ndev = qml.device(\"default.qubit\", wires=qubits)\n\n@qml.qnode(dev)\ndef circuit(params, wires, s_wires, d_wires, hf_state):\n    qml.UCCSD(params, wires, s_wires, d_wires, hf_state)\n    return qml.expval(H)\n\nparams = np.random.random(len(singles) + len(doubles))\nprint(params)\n\noptimizer = qml.GradientDescentOptimizer(stepsize=0.1)\n\nfor n in range(11):\n    %time params, energy = optimizer.step_and_cost(circuit, params,wires=range(qubits), s_wires=s_wires, d_wires=d_wires, hf_state=hf_state)\n    if n % 2 == 0:\n        print(\"step = {:},  E = {:.8f} Ha\".format(n, energy))\n\nWith PennyLane 0.26 I obtain the following:\nCPU times: user 694 ms, sys: 0 ns, total: 694 ms\nWall time: 1.38 s\n[0.78535858 0.77997581 0.27259261 0.27646426 0.80187218 0.95813935\n0.87593263 0.35781727]\nCPU times: user 673 ms, sys: 0 ns, total: 673 ms\nWall time: 1.35 s\nstep = 0,  E = 0.26146914 Ha\nCPU times: user 564 ms, sys: 0 ns, total: 564 ms\nWall time: 1.12 s\nCPU times: user 688 ms, sys: 0 ns, total: 688 ms\nWall time: 1.37 s\nstep = 2,  E = 0.24324925 Ha\nCPU times: user 566 ms, sys: 0 ns, total: 566 ms\nWall time: 1.13 s\nCPU times: user 681 ms, sys: 0 ns, total: 681 ms\nWall time: 1.36 s\nstep = 4,  E = 0.22191782 Ha\nCPU times: user 697 ms, sys: 0 ns, total: 697 ms\nWall time: 1.39 s\nCPU times: user 568 ms, sys: 0 ns, total: 568 ms\nWall time: 1.14 s\nstep = 6,  E = 0.19712825 Ha\nCPU times: user 690 ms, sys: 1.68 ms, total: 692 ms\nWall time: 1.37 s\nCPU times: user 565 ms, sys: 0 ns, total: 565 ms\nWall time: 1.12 s\nstep = 8,  E = 0.16858973 Ha\nCPU times: user 690 ms, sys: 0 ns, total: 690 ms\nWall time: 1.38 s\nCPU times: user 570 ms, sys: 9.75 ms, total: 580 ms\nWall time: 1.16 s\nstep = 10,  E = 0.13611113 Ha\nWith PennyLane 0.27.0 I get this:\nCPU times: user 690 ms, sys: 10.8 ms, total: 701 ms\nWall time: 1.97 s\n[0.78535858 0.77997581 0.27259261 0.27646426 0.80187218 0.95813935\n0.87593263 0.35781727]\nCPU times: user 572 ms, sys: 2.63 ms, total: 575 ms\nWall time: 1.15 s\nstep = 0,  E = -0.73428150 Ha\nCPU times: user 672 ms, sys: 6.1 ms, total: 678 ms\nWall time: 1.37 s\nCPU times: user 566 ms, sys: 1.18 ms, total: 567 ms\nWall time: 1.13 s\nstep = 2,  E = -0.76374619 Ha\nCPU times: user 664 ms, sys: 18.3 ms, total: 682 ms\nWall time: 1.37 s\nCPU times: user 672 ms, sys: 0 ns, total: 672 ms\nWall time: 1.36 s\nstep = 4,  E = -0.79437752 Ha\nCPU times: user 564 ms, sys: 0 ns, total: 564 ms\nWall time: 1.15 s\nCPU times: user 676 ms, sys: 0 ns, total: 676 ms\nWall time: 1.36 s\nstep = 6,  E = -0.82591780 Ha\nCPU times: user 566 ms, sys: 0 ns, total: 566 ms\nWall time: 728 ms\nCPU times: user 689 ms, sys: 20.8 ms, total: 710 ms\nWall time: 1.26 s\nstep = 8,  E = -0.85804157 Ha\nCPU times: user 581 ms, sys: 1.7 ms, total: 583 ms\nWall time: 1.41 s\nCPU times: user 692 ms, sys: 5.81 ms, total: 697 ms\nWall time: 1.68 s\nstep = 10,  E = -0.89036698 Ha\nI expected to get the same results with both version. What has changed? Which is the correct one?\nThanks in advance!", "link": "https://discuss.pennylane.ai//t/different-results-with-vqe-on-versions-0-26-0-and-0-27-0/2332/4"}}