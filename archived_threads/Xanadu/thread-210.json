{"0": {"author": "quantum_alejandro", "date": "1626123386681", "content": "Hi PennyLane team!\nI am trying to execute two QNodes at the same time but something goes wrong:\nimport pennylane as qml\n\ndev = qml.device(\"default.qubit\", wires=2)\n\n@qml.qnode(dev)\ndef circuit1(x, y):\n    qml.Hadamard(0)\n    qml.RX(x, wires=0)\n    qml.RY(y, wires=1)\n    qml.CNOT(wires=[0, 1])\n    return qml.expval(qml.PauliZ(0))\n\n@qml.qnode(dev)\ndef circuit2(x, y):\n    qml.RX(x, wires=0)\n    qml.RY(y, wires=0)\n    return qml.expval(qml.PauliY(0)), qml.probs(wires=[0,1])\n\nqnodes = qml.QNodeCollection([circuit1, circuit2])\n\nqnodes(0.5643, -0.45)\n\n~/pennylane/pennylane/collections/qnode_collection.py in convert_results(results, interface)\n    269             from autograd import numpy as np\n    270 \n--> 271             return np.stack(results)\n    272 \n    273         return results\n\n~/autograd/autograd/numpy/numpy_wrapper.py in stack(arrays, axis)\n     92     shapes = set(arr.shape for arr in arrays)\n     93     if len(shapes) != 1:\n---> 94         raise ValueError('all input arrays must have the same shape')\n     95 \n     96     result_ndim = arrays[0].ndim + 1\n\nValueError: all input arrays must have the same shape\n\nPlease help me, what is the issue here?1", "link": "https://discuss.pennylane.ai//t/two-qnodes-execution-error/1192/1"}, "1": {"author": "anishrverma", "date": "1627595282873", "content": "Hi @quantum_alejandro!\nI was able to replicate the issue on my end. I noticed that each node, if run and called by itself, works perfectly fine. The issue arose when I tried to evaluate both using qml.QNodeCollection\nReferring to the documentation, linked here 1, QNodeCollection\n\n[r]epresents a sequence of independent QNodes that all share the same signature. When the collection is evaluated, all QNodes are simultaneously evaluated with the same parameters.\n\nand\n\nthe results from each QNode have been flattened and concatenated into a single one-dimensional list.\n\nNow, circuit1(0.5643, -0.45) returns 0.0, while circuit1(0.5643, -0.45) returns  [-0.53482447  0.23258776  0.          0.76741224  0.        ]\nNote here that the outputs are different in form, and flattening and concatenating this to a single one-dimensional list returns an error.\nThis is why when running\nqnodes = qml.QNodeCollection([circuit1, circuit2])\n\nqnodes(0.5643, -0.45)\n\nwe get the error: ValueError: all input arrays must have the same shape.\nNow, I also want to note that by default, the qnodes within QNodeCollection are executed sequentially.\nFor this reason, as a way of getting the code to run, we can try running them individually:\nimport pennylane as qml\n\ndev = qml.device(\"default.qubit\", wires=2)\n\n@qml.qnode(dev)\ndef circuit1(x, y):\n    qml.Hadamard(0)\n    qml.RX(x, wires=0)\n    qml.RY(y, wires=1)\n    qml.CNOT(wires=[0, 1])\n    return qml.expval(qml.PauliZ(0))\n\n@qml.qnode(dev)\ndef circuit2(x, y):\n    qml.RX(x, wires=0)\n    qml.RY(y, wires=0)\n    return qml.expval(qml.PauliY(0)), qml.probs(wires=[0,1])\n\nresult1 = circuit1(0.5643, -0.45)\nresult2 = circuit2(0.5643, -0.45)\n\nwhere your results for circuit1 and circuit2 are stored in result1 and result2, respectively.\nThis should work.\nFor a fix using QNodeCollection, we need to ensure that the output of both circuits have the appropriate form, which is more of a Python formatting thing.\nI hope this helps!1", "link": "https://discuss.pennylane.ai//t/two-qnodes-execution-error/1192/2"}, "2": {"author": "quantum_alejandro", "date": "1627653550283", "content": "Dear @anishrverma,\nThank you for the details! That\u2019s very helpful, will be using this from now on then.\nThanks again!1", "link": "https://discuss.pennylane.ai//t/two-qnodes-execution-error/1192/3"}, "3": {"author": "anishrverma", "date": "1627658005627", "content": "Dear @quantum_alejandro,\nYou\u2019re very welcome!\nThank you for your questions and participating on the Xanadu discussion forum. I wish you the best in your experience with Pennylane, and hope you continue to participate in the forums, perhaps helping others as well!1", "link": "https://discuss.pennylane.ai//t/two-qnodes-execution-error/1192/4"}, "4": {"author": "quantum_alejandro", "date": "1626123386681", "content": "Hi PennyLane team!\nI am trying to execute two QNodes at the same time but something goes wrong:\nimport pennylane as qml\n\ndev = qml.device(\"default.qubit\", wires=2)\n\n@qml.qnode(dev)\ndef circuit1(x, y):\n    qml.Hadamard(0)\n    qml.RX(x, wires=0)\n    qml.RY(y, wires=1)\n    qml.CNOT(wires=[0, 1])\n    return qml.expval(qml.PauliZ(0))\n\n@qml.qnode(dev)\ndef circuit2(x, y):\n    qml.RX(x, wires=0)\n    qml.RY(y, wires=0)\n    return qml.expval(qml.PauliY(0)), qml.probs(wires=[0,1])\n\nqnodes = qml.QNodeCollection([circuit1, circuit2])\n\nqnodes(0.5643, -0.45)\n\n~/pennylane/pennylane/collections/qnode_collection.py in convert_results(results, interface)\n    269             from autograd import numpy as np\n    270 \n--> 271             return np.stack(results)\n    272 \n    273         return results\n\n~/autograd/autograd/numpy/numpy_wrapper.py in stack(arrays, axis)\n     92     shapes = set(arr.shape for arr in arrays)\n     93     if len(shapes) != 1:\n---> 94         raise ValueError('all input arrays must have the same shape')\n     95 \n     96     result_ndim = arrays[0].ndim + 1\n\nValueError: all input arrays must have the same shape\n\nPlease help me, what is the issue here?1", "link": "https://discuss.pennylane.ai//t/two-qnodes-execution-error/1192/5"}}