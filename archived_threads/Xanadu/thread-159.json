{"0": {"author": "Einar_Gabbassov", "date": "1689182755424", "content": "Dear Pennylane team,\nThis post is related to my previous post 3 where I tried to create a Hamiltonian for a large molecule. Back then Pennylane took long time to create a Hamiltonian and then crashed the system. The solution was offered but it crashed the Jupter lab (not the entire system). So I moved to other frameworks that handled this situation.\nToday, I tried to get past the stage of Hamiltonian creation and get the circuit for the Hamiltonian.  Unfortunattely, it seems Pennylane still can\u2019t deal with relatively large molecules as it produces an error during the circuit creation.\nHere is the code:\nmolecule == \"C2HF3\"\nsymbols = [\"C\", \"C\", \"F\", \"F\", \"F\", \"H\"]\ncoordinates = (\n    np.array(\n        [\n            0.0,\n            0.430631,\n            0.000000,\n            -0.704353,\n            -0.686847,\n            0.0,\n            1.314791,\n            0.500587,\n            0.0,\n            -0.554822,\n            1.630861,\n            0.0,\n            -0.092517,\n            -1.882156,\n            0.0,\n            -1.780948,\n            -0.706341,\n            0.0,\n        ]\n    ) / 0.529177210903\nhamiltonian, num_qubits = qchem.molecular_hamiltonian(\n    symbols, coordinates, method=\"pyscf\"\n)\nprint(f\"Number of qubits: {num_qubits}\")\n# print(hamiltonian)\n\n\n# Init device\nwires = range(num_qubits)\nnum_wires = num_qubits\n\ndev = qml.device(\"default.qubit\", wires=wires)\n\n# Build a circuit\nevolution_time = 0.5\ntrotter_steps = 1\ncoeffs_and_time = [*hamiltonian.coeffs, evolution_time]\n\n\n@qml.qnode(dev)\ndef circuit(evolution_time):\n    ApproxTimeEvolution.compute_decomposition(\n        *coeffs_and_time, wires=wires, n=trotter_steps, hamiltonian=hamiltonian\n    )\n    return [qml.expval(qml.PauliZ(wires=i)) for i in wires]\n\nspecs_func = qml.specs(circuit, expansion_strategy=\"device\")\nprint(specs_func(evolution_time))\n\n\nThe output:\nTraceback (most recent call last):\n  File \"/home/user1/x/x-x/circuit_compilation/qchem/chem_circuits_sk.py\", line 80, in <module>\n    dev = qml.device(\"default.qubit\", wires=wires)\n  File \"/home/user1/x/x-x/circuit_compilation/qalgs_env/lib/python3.10/site-packages/pennylane/__init__.py\", line 337, in device\n    dev = plugin_device_class(*args, **options)\n  File \"/home/user1/x/x-x/circuit_compilation/qalgs_env/lib/python3.10/site-packages/pennylane/devices/default_qubit.py\", line 205, in __init__\n    self._state = self._create_basis_state(0)\n  File \"/home/user1/x/x-x/circuit_compilation/qalgs_env/lib/python3.10/site-packages/pennylane/devices/default_qubit.py\", line 705, in _create_basis_state\n    state = np.zeros(2**self.num_wires, dtype=np.complex128)\nnumpy.core._exceptions._ArrayMemoryError: Unable to allocate 64.0 PiB for an array with shape (4503599627370496,) and data type complex128\n(qalgs_env) user1@linuxpc:~/x/x-Research/circuit_compilation/qchem$ \n\nVersion:\nName: PennyLane\nVersion: 0.31.0\nPlatform info:           Linux-5.19.0-46-generic-x86_64-with-glibc2.35\nPython version:          3.10.6\nNumpy version:           1.23.5\nScipy version:           1.10.0", "link": "https://discuss.pennylane.ai//t/failing-to-create-a-circuit-for-a-large-molecule/3183/1"}, "1": {"author": "isaacdevlugt", "date": "1689273483672", "content": "Hey @Einar_Gabbassov!\nUnfortunately, reaching this high of a qubit count is not possible right now. But, we\u2019re adding some high-performance devices in the coming few months that should help you reach these qubit counts!\nWe\u2019ve tagged this forum post in the internal pipeline we have for creating new features in PennyLane . Be on the lookout for a reply from us when the high-performance devices become available! ", "link": "https://discuss.pennylane.ai//t/failing-to-create-a-circuit-for-a-large-molecule/3183/2"}, "2": {"author": "isaacdevlugt", "date": "1689793672207", "content": "Hey @Einar_Gabbassov!\nWe\u2019re curious about what other framework(s) you\u2019ve been using that does allow you to simulate something this large . Let us know if you can ", "link": "https://discuss.pennylane.ai//t/failing-to-create-a-circuit-for-a-large-molecule/3183/3"}, "3": {"author": "Einar_Gabbassov", "date": "1689798353080", "content": "hi @isaacdevlugt\nThere are two parts to it:\n\nGetting a description of a quantum circuit which could be a python object (like Qiskit Circuit) or  a QASM file. This is where Pennylane fails me so far. The key point is that the description may not require numpy array allocations.\nGetting the object or QASM file into a simulator or a compiler.\n\nFor the first part, I use Tangelo which is developed by my ex-1Qbit colleagues. For the second part, I can\u2019t comment on it.\nHope this was anyhow useful.2 Replies1", "link": "https://discuss.pennylane.ai//t/failing-to-create-a-circuit-for-a-large-molecule/3183/4"}, "4": {"author": "isaacdevlugt", "date": "1689800630802", "content": "Thank you! This is useful information for us. Will get back to you here when we have a solution for you in PennyLane! ", "link": "https://discuss.pennylane.ai//t/failing-to-create-a-circuit-for-a-large-molecule/3183/5"}, "5": {"author": "isaacdevlugt", "date": "1690207280628", "content": "\n\n\n Einar_Gabbassov:\n\nFor the second part, I can\u2019t comment on it.\n\n\nDo you mean that this is this confidential, or that you aren\u2019t able to do it? ", "link": "https://discuss.pennylane.ai//t/failing-to-create-a-circuit-for-a-large-molecule/3183/6"}, "6": {"author": "Einar_Gabbassov", "date": "1689182755424", "content": "Dear Pennylane team,\nThis post is related to my previous post 3 where I tried to create a Hamiltonian for a large molecule. Back then Pennylane took long time to create a Hamiltonian and then crashed the system. The solution was offered but it crashed the Jupter lab (not the entire system). So I moved to other frameworks that handled this situation.\nToday, I tried to get past the stage of Hamiltonian creation and get the circuit for the Hamiltonian.  Unfortunattely, it seems Pennylane still can\u2019t deal with relatively large molecules as it produces an error during the circuit creation.\nHere is the code:\nmolecule == \"C2HF3\"\nsymbols = [\"C\", \"C\", \"F\", \"F\", \"F\", \"H\"]\ncoordinates = (\n    np.array(\n        [\n            0.0,\n            0.430631,\n            0.000000,\n            -0.704353,\n            -0.686847,\n            0.0,\n            1.314791,\n            0.500587,\n            0.0,\n            -0.554822,\n            1.630861,\n            0.0,\n            -0.092517,\n            -1.882156,\n            0.0,\n            -1.780948,\n            -0.706341,\n            0.0,\n        ]\n    ) / 0.529177210903\nhamiltonian, num_qubits = qchem.molecular_hamiltonian(\n    symbols, coordinates, method=\"pyscf\"\n)\nprint(f\"Number of qubits: {num_qubits}\")\n# print(hamiltonian)\n\n\n# Init device\nwires = range(num_qubits)\nnum_wires = num_qubits\n\ndev = qml.device(\"default.qubit\", wires=wires)\n\n# Build a circuit\nevolution_time = 0.5\ntrotter_steps = 1\ncoeffs_and_time = [*hamiltonian.coeffs, evolution_time]\n\n\n@qml.qnode(dev)\ndef circuit(evolution_time):\n    ApproxTimeEvolution.compute_decomposition(\n        *coeffs_and_time, wires=wires, n=trotter_steps, hamiltonian=hamiltonian\n    )\n    return [qml.expval(qml.PauliZ(wires=i)) for i in wires]\n\nspecs_func = qml.specs(circuit, expansion_strategy=\"device\")\nprint(specs_func(evolution_time))\n\n\nThe output:\nTraceback (most recent call last):\n  File \"/home/user1/x/x-x/circuit_compilation/qchem/chem_circuits_sk.py\", line 80, in <module>\n    dev = qml.device(\"default.qubit\", wires=wires)\n  File \"/home/user1/x/x-x/circuit_compilation/qalgs_env/lib/python3.10/site-packages/pennylane/__init__.py\", line 337, in device\n    dev = plugin_device_class(*args, **options)\n  File \"/home/user1/x/x-x/circuit_compilation/qalgs_env/lib/python3.10/site-packages/pennylane/devices/default_qubit.py\", line 205, in __init__\n    self._state = self._create_basis_state(0)\n  File \"/home/user1/x/x-x/circuit_compilation/qalgs_env/lib/python3.10/site-packages/pennylane/devices/default_qubit.py\", line 705, in _create_basis_state\n    state = np.zeros(2**self.num_wires, dtype=np.complex128)\nnumpy.core._exceptions._ArrayMemoryError: Unable to allocate 64.0 PiB for an array with shape (4503599627370496,) and data type complex128\n(qalgs_env) user1@linuxpc:~/x/x-Research/circuit_compilation/qchem$ \n\nVersion:\nName: PennyLane\nVersion: 0.31.0\nPlatform info:           Linux-5.19.0-46-generic-x86_64-with-glibc2.35\nPython version:          3.10.6\nNumpy version:           1.23.5\nScipy version:           1.10.0", "link": "https://discuss.pennylane.ai//t/failing-to-create-a-circuit-for-a-large-molecule/3183/7"}}