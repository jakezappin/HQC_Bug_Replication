{"0": {"author": "Amandeep", "date": "1685022343467", "content": "X, y = make_moons(n_samples=200, noise=0.1)\ny_hot = tf.keras.utils.to_categorical(y, num_classes=2)\n\nn_qubits = 2\nn_layers = 4\ndev = qml.device(\"strawberryfields.fock\", wires=2, cutoff_dim=4) \n\ndef layer(theta, phi, wires):\n    M = len(wires)\n    phi_nonlinear = np.pi / 2\n\n    qml.templates.Interferometer(\n        theta, phi, np.zeros(M), wires=wires, mesh=\"rectangular\", beamsplitter=\"pennylane\"\n    )\n\n    for i in wires:\n        qml.Kerr(phi_nonlinear, wires=i)\n\n@qml.qnode(dev, interface=\"tf\")\ndef quantum_neural_net(inputs, weights):\n    wires = list(range(len(inputs)))\n\n    for i in wires:\n        qml.FockState(inputs[i], wires=i)\n\n    # \"layer\" subcircuits\n    for i, v in enumerate(weights):\n        layer(v[: len(v) // 2], v[len(v) // 2 :], wires)\n\n    return [qml.expval(qml.NumberOperator(w)) for w in wires]\n\nqlayer = qml.qnn.KerasLayer(quantum_neural_net, weight_shapes, output_dim=4)\n\nmodel.add(qlayer)\nopt = tf.keras.optimizers.SGD()\nmodel.compile(opt, loss = 'mae', metrics =['accuracy'])\n\nhistory = model.fit(X, y_hot, epochs=2, batch_size=4, validation_split=0.25, verbose=2)\n\nWhen i try to run qlayer with qml.qnn\u2026it throws an error of shape.\nand not able to fit the model.\nCan you please look in to it.", "link": "https://discuss.pennylane.ai//t/valueerror-must-specify-a-shape-for-every-non-input-parameter-in-the-qnode/2973/1"}, "1": {"author": "isaacdevlugt", "date": "1685029292033", "content": "Hey @Amandeep, can you please include all of your imports, the full error message, and your package versions?", "link": "https://discuss.pennylane.ai//t/valueerror-must-specify-a-shape-for-every-non-input-parameter-in-the-qnode/2973/2"}, "2": {"author": "Amandeep", "date": "1685029364426", "content": "Hi @isaacdevlugt\nimport tensorflow as tf\nimport pennylane as qml\n\nimport matplotlib.pyplot as plt\nimport numpy as np\nfrom sklearn.datasets import make_moons\n\n# Set random seeds\nnp.random.seed(42)\ntf.random.set_seed(42)\n\nfrom tensorflow import keras\nfrom tensorflow.keras import layers\n\n#pennylane=0.28.0\n", "link": "https://discuss.pennylane.ai//t/valueerror-must-specify-a-shape-for-every-non-input-parameter-in-the-qnode/2973/3"}, "3": {"author": "Amandeep", "date": "1685029622271", "content": "@isaacdevlugt\nI changed the code. Trying to work with qnode. It works but the issue is that the model accuracy and loss not making any progress as it showing in Turning quantum nodes into Keras Layers \u2014 PennyLane documentation\nweight_shapes = {\"weights\": (6, 2)}\nweight_shapes\n\nqlayer = qml.qnn.KerasLayer(quantum_neural_net, weight_shapes, output_dim=2)\nclayer_2 = tf.keras.layers.Dense(2, activation=\"softmax\")\nmodel = tf.keras.models.Sequential([qlayer, clayer_2])\n\nopt = keras.optimizers.SGD(learning_rate=0.2)\nmodel.compile(opt, loss = 'mae', metrics =['accuracy'])\n\nfitting = model.fit(X, y_hot, epochs=10, batch_size=8, validation_split=0.25, verbose=2)\n\nrest of the above code remains same.", "link": "https://discuss.pennylane.ai//t/valueerror-must-specify-a-shape-for-every-non-input-parameter-in-the-qnode/2973/4"}, "4": {"author": "isaacdevlugt", "date": "1685029820166", "content": "Can you please place the full code in one area? It\u2019s not obvious to me how everything gets pieced together to match exactly what you have.", "link": "https://discuss.pennylane.ai//t/valueerror-must-specify-a-shape-for-every-non-input-parameter-in-the-qnode/2973/5"}, "5": {"author": "Amandeep", "date": "1685029924489", "content": "@isaacdevlugt  here\u2019s the code\nimport tensorflow as tf\nimport pennylane as qml\n\nimport matplotlib.pyplot as plt\nimport numpy as np\nfrom sklearn.datasets import make_moons\n\n# Set random seeds\nnp.random.seed(42)\ntf.random.set_seed(42)\n\nfrom tensorflow import keras\nfrom tensorflow.keras import layers\n\n\ntf.keras.backend.set_floatx('float64')\n\nX, y = make_moons(n_samples=200, noise=0.1)\ny_hot = tf.keras.utils.to_categorical(y, num_classes=2)  # one-hot encoded labels\n\nn_qubits = 2\nn_layers = 4\ndev = qml.device(\"strawberryfields.fock\", wires=2, cutoff_dim=4) \n\ndef layer(theta, phi, wires):\n    M = len(wires)\n    phi_nonlinear = np.pi / 2\n\n    qml.templates.Interferometer(\n        theta, phi, np.zeros(M), wires=wires, mesh=\"rectangular\", beamsplitter=\"pennylane\"\n    )\n\n    for i in wires:\n        qml.Kerr(phi_nonlinear, wires=i)\n\n@qml.qnode(dev)\ndef quantum_neural_net(inputs, weights):\n    wires = list(range(len(inputs)))\n\n    for i in wires:\n        qml.FockState(inputs[i], wires=i)\n\n    # \"layer\" subcircuits\n    for i, v in enumerate(weights):\n        layer(v[: len(v) // 2], v[len(v) // 2 :], wires)\n\n    return [qml.expval(qml.NumberOperator(w)) for w in wires]\n\nweight_shapes = {\"weights\": (6, 2)}\nweight_shapes\n\nqlayer = qml.qnn.KerasLayer(quantum_neural_net, weight_shapes, output_dim=2)\nclayer_2 = tf.keras.layers.Dense(2, activation=\"softmax\")\nmodel = tf.keras.models.Sequential([qlayer, clayer_2])\n\nopt = keras.optimizers.SGD(learning_rate=0.2)\nmodel.compile(opt, loss = 'mae', metrics =['accuracy'])\n\nfitting = model.fit(X, y_hot, epochs=10, batch_size=8, validation_split=0.25, verbose=2)\n\nIt works but the issue is that the model accuracy and loss not making any progress as it showing in Turning quantum nodes into Keras Layers \u2014 PennyLane documentation", "link": "https://discuss.pennylane.ai//t/valueerror-must-specify-a-shape-for-every-non-input-parameter-in-the-qnode/2973/6"}, "6": {"author": "isaacdevlugt", "date": "1685108227578", "content": "\n\u2026 the model accuracy and loss not making any progress \u2026\n\nYou\u2019re trying out a very different hybrid model here compared to what\u2019s in the tutorial. I was able to run your code and see that your loss and accuracy are changing, albeit not very much. This is probably an opportunity to reflect on your quantum model\u2019s structure, your optimizer, and other hyperparameters.", "link": "https://discuss.pennylane.ai//t/valueerror-must-specify-a-shape-for-every-non-input-parameter-in-the-qnode/2973/7"}, "7": {"author": "Amandeep", "date": "1685109140408", "content": "@isaacdevlugt\nis there anything missing? or I need to add", "link": "https://discuss.pennylane.ai//t/valueerror-must-specify-a-shape-for-every-non-input-parameter-in-the-qnode/2973/8"}, "8": {"author": "isaacdevlugt", "date": "1685114921688", "content": "The code works in that it\u2019s doing what it\u2019s programmed to do. It\u2019s just not doing it very well . It\u2019s probably a good idea to tinker with hyperparameters, different loss functions, etc.1", "link": "https://discuss.pennylane.ai//t/valueerror-must-specify-a-shape-for-every-non-input-parameter-in-the-qnode/2973/9"}, "9": {"author": "Amandeep", "date": "1685022343467", "content": "X, y = make_moons(n_samples=200, noise=0.1)\ny_hot = tf.keras.utils.to_categorical(y, num_classes=2)\n\nn_qubits = 2\nn_layers = 4\ndev = qml.device(\"strawberryfields.fock\", wires=2, cutoff_dim=4) \n\ndef layer(theta, phi, wires):\n    M = len(wires)\n    phi_nonlinear = np.pi / 2\n\n    qml.templates.Interferometer(\n        theta, phi, np.zeros(M), wires=wires, mesh=\"rectangular\", beamsplitter=\"pennylane\"\n    )\n\n    for i in wires:\n        qml.Kerr(phi_nonlinear, wires=i)\n\n@qml.qnode(dev, interface=\"tf\")\ndef quantum_neural_net(inputs, weights):\n    wires = list(range(len(inputs)))\n\n    for i in wires:\n        qml.FockState(inputs[i], wires=i)\n\n    # \"layer\" subcircuits\n    for i, v in enumerate(weights):\n        layer(v[: len(v) // 2], v[len(v) // 2 :], wires)\n\n    return [qml.expval(qml.NumberOperator(w)) for w in wires]\n\nqlayer = qml.qnn.KerasLayer(quantum_neural_net, weight_shapes, output_dim=4)\n\nmodel.add(qlayer)\nopt = tf.keras.optimizers.SGD()\nmodel.compile(opt, loss = 'mae', metrics =['accuracy'])\n\nhistory = model.fit(X, y_hot, epochs=2, batch_size=4, validation_split=0.25, verbose=2)\n\nWhen i try to run qlayer with qml.qnn\u2026it throws an error of shape.\nand not able to fit the model.\nCan you please look in to it.", "link": "https://discuss.pennylane.ai//t/valueerror-must-specify-a-shape-for-every-non-input-parameter-in-the-qnode/2973/10"}}