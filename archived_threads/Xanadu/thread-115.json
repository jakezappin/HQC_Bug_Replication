{"0": {"author": "sassan_moradi", "date": "1647857038856", "content": "I want to add two control qubits to a statepreparation method. how can i do it? here is the code\nimport numpy as np\nimport pennylane as qml\n\nnum_qubits = 4\ndev = qml.device('default.qubit', wires=num_qubits, shots=8192)\n\ndef Stateper(X):\n\treturn qml.templates.MottonenStatePreparation(X, wires=[2, 3])\n\n@qml.qnode(dev)\ndef circuit(X):\n\tqml.ControlledQubitUnitary(Stateper(X), control_wires=[0, 1], wires=[3, 4], control_values='11') # control qubits  = [0, 1] and target=[3, 4]\n\treturn qml.state()\n\nX = [1/2, 1/2, 1/2, 1/2]\nprint(circuit(X))\n", "link": "https://discuss.pennylane.ai//t/add-control-qubits-to-states/1744/1"}, "1": {"author": "CatalinaAlbornoz", "date": "1647903696536", "content": "Hi @sassan_moradi, I\u2019m not sure what\u2019s the exact error you\u2019re getting but I think the issue is that the wires has to be an iterable. This means that it needs to be something like wires=range(3). In your case for wires=[2,3] you would need wires=range(2,4).\nPlease let me know if this solves your problem! If not please share the error message you\u2019re getting.", "link": "https://discuss.pennylane.ai//t/add-control-qubits-to-states/1744/2"}, "2": {"author": "sassan_moradi", "date": "1648794755358", "content": "if len(U) != target_dim:\nTypeError: object of type \u2018MottonenStatePreparation\u2019 has no len()", "link": "https://discuss.pennylane.ai//t/add-control-qubits-to-states/1744/3"}, "3": {"author": "CatalinaAlbornoz", "date": "1648825298892", "content": "Hi @sassan_moradi,\nI couldn\u2019t replicate your error but using the ctrl function you can achieve the result you want in an easier way. The following code should work for you:\nimport pennylane as qml\nfrom pennylane import numpy as np\n\nnum_qubits = 4\ndev = qml.device('default.qubit', wires=num_qubits, shots=8192)\n\ndef Stateper(X):\n    return qml.MottonenStatePreparation(X, wires=range(2,4))\n\nop = qml.ctrl(Stateper,control=[0,1])\n\nX = np.array([1/2, 1/2, 1/2, 1/2])\n\n@qml.qnode(dev)\ndef circuit(X):\n    op(X)\n    return qml.state()\n\nprint(circuit(X))\nprint(qml.draw_mpl(circuit)(X))\n\nYou will notice a few things:\n\nI imported numpy directly from PennyLane. This is important, specially when you need to set your parameters as trainable or not.\nIn the MottonenStatePreparation the wires are defined as a range because this value needs to be an iterable.\nI used the ctrl function to specify the control qubits. This is equivalent to op1 = qml.ctrl(qml.ctrl(Stateper, 1), 0)\n\nX is set as a numpy array. If you don\u2019t set it this way it will still work but when you use qml.draw_mpl you won\u2019t see the details of the circuit.\n\nPlease let me know if this is what you were looking for!\nIf this code doesn\u2019t work try making sure that you\u2019re using the latest PennyLane version. If it still doesn\u2019t work please let me know.", "link": "https://discuss.pennylane.ai//t/add-control-qubits-to-states/1744/4"}, "4": {"author": "sassan_moradi", "date": "1648826200894", "content": "many thanks for your useful response. i will try it and get back to you.", "link": "https://discuss.pennylane.ai//t/add-control-qubits-to-states/1744/5"}, "5": {"author": "sassan_moradi", "date": "1648826814053", "content": "how can i use ctrl function, if i want to have control_value = \u201801\u2019? but my problem is still with control value.", "link": "https://discuss.pennylane.ai//t/add-control-qubits-to-states/1744/6"}, "6": {"author": "CatalinaAlbornoz", "date": "1649111551144", "content": "Hi @sassan_moradi, I\u2019m not understanding your question. Did the code example show you an error? Or do you want a different functionality? In the example above the control qubits are \u20180\u2019 and \u20181\u2019. (op = qml.ctrl(Stateper,control=[0,1]))\nThe ctrl function receives a python function and the control wires as parameters and it returns the controlled version of the function.\nYou can read more about it here 1.\nPlease let me know if this answers your question or if it doesn\u2019t please provide more details or an example of what you mean.", "link": "https://discuss.pennylane.ai//t/add-control-qubits-to-states/1744/7"}, "7": {"author": "sassan_moradi", "date": "1649146113675", "content": "the example was true. i could run it successfully. But i want different functionality. for example, we know the quantum circuit for M\u00f6ttonen state and as far as i know qml.ControlledQubitUnitary only take a matrix (gate) as an argument. Your example only consider control value = \u201811\u2019. i want to also have control value = \u201801\u2019. One way that i can do in qiskit is to design quantum circuit and then use convert to gate method which can convert a quantum circuit to a unitary matrix. I don\u2019t know if Pennylane can do it or not.", "link": "https://discuss.pennylane.ai//t/add-control-qubits-to-states/1744/8"}, "8": {"author": "CatalinaAlbornoz", "date": "1649181858325", "content": "Oh I see now @sassan_moradi.\nYou can use qml.matrix to get the matrix representation of your quantum circuit. Here in the \u201cusage details\u201d section you can see how to use it.\nOn the other hand, if you want your control value to be \u201801\u2019 then you only need to add a PauliX gate to your first qubit before you apply the control. So the code above can remain the same except that your circuit function is now:\ndef circuit(X):\n    qml.PauliX(0)\n    op(X)\n    return qml.state()\n\nPlease let me know if this helps!", "link": "https://discuss.pennylane.ai//t/add-control-qubits-to-states/1744/9"}, "9": {"author": "sassan_moradi", "date": "1649233607081", "content": "many thanks. i think using PauliX gate can be the only solution for it at this moment.", "link": "https://discuss.pennylane.ai//t/add-control-qubits-to-states/1744/10"}, "10": {"author": "CatalinaAlbornoz", "date": "1649289625476", "content": "Hi @sassan_moradi, you could always create a state-preparation function where you input a string and it performs the necessary PauliX gates according to your needs. It really depends on how automated you need this to be but you could even use an embedding template or a custom embedding to generate rotations according to the values that you want as a control.\nThe Basis Embedding 1 in particular may be very useful for you.\nLet me know if this helps!", "link": "https://discuss.pennylane.ai//t/add-control-qubits-to-states/1744/11"}, "11": {"author": "sassan_moradi", "date": "1649332968469", "content": "Many thanks for your instructive responses. They were very helpful.", "link": "https://discuss.pennylane.ai//t/add-control-qubits-to-states/1744/12"}, "12": {"author": "CatalinaAlbornoz", "date": "1649364420318", "content": "I\u2019m glad I could help @sassan_moradi!", "link": "https://discuss.pennylane.ai//t/add-control-qubits-to-states/1744/13"}}