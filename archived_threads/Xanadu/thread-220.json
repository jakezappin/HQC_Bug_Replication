{"0": {"author": "diemilio", "date": "1682009009166", "content": "At the end of exercise H.6.7, a plot is displayed and we are asked: \u201cDo the results make sense?\u201d. Unfortunately, I have spent quite some time trying to figure out why the plot looks the way it does, but I haven\u2019t been able to figure it out (here\u2019s the output from the codebook):\n\nimage1242\u00d71110 59.7 KB\n\nThe green trace is not too difficult to calculate: cos(-t); but when I derive the equation for the first order approximation, I get that the output state (when the |0\\rangle state is measured in the aux register) should be:\n\\frac{1}{\\sqrt{t^2 + 1}} \\left(|0\\rangle + i t|1\\rangle \\right).\nThis is already a normalized state, so I expected the coefficient of the |0\\rangle to be \\frac{1}{\\sqrt{t^2 + 1}}, giving the following red trace:\n\nimage1242\u00d7960 61 KB\n\nTo double check if I had made a mistake, I ran circuit simulations for both the first order and second order approximations where I extract the zero-stat coefficient after measuring the aux register:\n\nimage904\u00d7682 45.1 KB\n\nThe first-order approx result matches my calculation, so I was wondering if perhaps the plot from the codebook is incorrect, or if I am making a mistake somewhere.\nThanks in advance for the help!!", "link": "https://discuss.pennylane.ai//t/codercise-h-6-7-interpreting-the-output-plot/2859/1"}, "1": {"author": "isaacdevlugt", "date": "1682088735841", "content": "Hey @diemilio! It looks like our plot is indeed incorrect . It makes sense that ours is wrong because the coefficient of \\vert 0 \\rangle should never be larger than 1 regardless of the approximation!\nI corrected our solution and I match your results:\n\nScreenshot 2023-04-20 at 5.27.09 PM1004\u00d7732 74.3 KB\n\nIt\u2019s curious to me that the 2nd order approximation is worse than the 1st order one\u2026 I verified this algebraically though and it seems like this is the correct result (pink is 2nd order):\n\nScreenshot 2023-04-21 at 10.46.56 AM1078\u00d71010 66.4 KB\n\nI\u2019ll think on this a little more\u2026 In the mean time, I will make the correction to codebook.xanadu.ai! Thanks so much for finding this and excellent work!1", "link": "https://discuss.pennylane.ai//t/codercise-h-6-7-interpreting-the-output-plot/2859/2"}, "2": {"author": "diemilio", "date": "1682110232672", "content": "Thank you so much @isaacdevlugt; makes sense.\nI hope you don\u2019t mind if I ask a couple of more questions.\nI\u2019ve been working on the derivation for the second-order approximation, but I am having a bit of trouble getting it to match my sim results (or even your results).\n\nFrom the textbook, I got the impression that the circuit for the second order approximation would generate a state of the form \\left(U^0 + tU^1 + \\frac{1}{2}t^2 U^2 \\right)|\\psi\\rangle, up to some normalization factor, but what I actually get is \\left((1+\\frac{t}{2}) U^0 + tU^1 + \\frac{1}{2}t^2 U^2 \\right)|\\psi\\rangle. Is this an error from my part? If not, is there a way to deal with this? Could the presence of this coefficient be the reason why your results for the second-order are worse than the first order?\nSince the second order approximation of e^{itX} is given by:\n\\tilde{U} = I + itX + \\frac{1}{2}(itX)^2\n\\tilde{U} = I + itX - \\frac{1}{2}t^2I\nin order to match the coefficient of state |\\psi\\rangle with this expression, I would need:\nU^2 = -I\nU^1 = iX\n U^0 = (1+\\frac{t}{2})^{-1} I,\nmaking U^0 a non-trivial, non-normalized matrix that depends on t, which doesn\u2019t seem right . Now, even if I just make U^0 = I, I still don\u2019t get the same result as you. In that case, my final state (when |00\\rangle is measured in the top qubits) would be:\n|\\zeta\\rangle = \\frac{1}{\\sqrt{t^4/4 + t^2 + (t/2+1)^2}} \\left((1+\\frac{t}{2})U^0 + tU^1 + \\frac{1}{2}t^2 U^2 \\right)|\\psi\\rangle \n|\\zeta\\rangle = \\frac{1}{\\sqrt{t^4/4 + t^2 + (t/2+1)^2}} \\left((1+\\frac{t}{2})I + itX - \\frac{1}{2}t^2 I \\right)|\\psi\\rangle \nWhich, for |\\psi\\rangle = |0\\rangle:\n|\\zeta\\rangle = \\frac{1}{\\sqrt{t^4/4 + t^2 + (t/2+1)^2}} \\left(\\left(-t^2/2 + t/2 + 1 \\right)|0\\rangle + it|1\\rangle\\right) \nThe coeff of the |0\\rangle would be just this part:\n\\frac{\\left(-t^2/2 + t/2 + 1 \\right)}{\\sqrt{t^4/4 + t^2 + (t/2+1)^2}}\nwhich decreases a lot faster than your plot (and my sim for that matter).\n\nAny idea on where I might be going wrong? I can also send the complete derivation if that helps.\nThanks!", "link": "https://discuss.pennylane.ai//t/codercise-h-6-7-interpreting-the-output-plot/2859/3"}, "3": {"author": "isaacdevlugt", "date": "1682347929123", "content": "Hey @diemilio,\nThe second-order approx should definitely be U^0 + tU^1 + \\frac{1}{2}t^2U^2 up to normalization, where the normalization was done before the measurement (measure 0 on both auxiliary qubits), so I\u2019m not 100% certain on where you\u2019ve made a mistake .\nMaybe checking out the original paper will help?\n\n\narxiv.org\n\n\n\n1202.5822.pdf 2\n492.13 KB\n\n\n\n\n\n", "link": "https://discuss.pennylane.ai//t/codercise-h-6-7-interpreting-the-output-plot/2859/4"}, "4": {"author": "diemilio", "date": "1682354848643", "content": "Thanks so much, @isaacdevlugt. I will check the original paper.\nWhen you say \u201cthe normalization was done before the measurement\u201d, did you mean after measurement? Isn\u2019t the state already normalized before the measurement? Maybe I am missing something here, and this is where I\u2019m going wrong\nI have attached my derivation if you are interested in spotting errors other people\u2019s errors lol, but I know you\u2019re busy so I understand if you don\u2019t have time to look into it \nThanks again for all the help!\n\nimage1196\u00d71592 188 KB\n\n\nimage1198\u00d71226 103 KB\n", "link": "https://discuss.pennylane.ai//t/codercise-h-6-7-interpreting-the-output-plot/2859/5"}, "5": {"author": "diemilio", "date": "1682383066787", "content": "I found my mistake.\nI forgot to add the control to the V_{t/2} and V^\\dagger_{t/2} gates!! \nI will fix that and see if I finally get my results to match.\nEdit: After working on the derivation including the controls for V_{t/2} and V^\\dagger_{t/2}, I get the same result. I also just saw from section H.7. of the textbook that this should be in fact the case because V_{t/2} V^\\dagger_{t/2} cancel each other out if they\u2019re not applied, so I am still trying to figure out where I went wrong 1 Reply1", "link": "https://discuss.pennylane.ai//t/codercise-h-6-7-interpreting-the-output-plot/2859/6"}, "6": {"author": "diemilio", "date": "1682434880589", "content": "OK, I FINALLY found my mistake. It was in the normalization. I was assuming that the coefficients of the superpositions were real-valued even after applying U^0, U^1, U^2, which is clearly not the case, so my normalization was wrong.\nHere\u2019s the correct result:\n\nimage1196\u00d71588 187 KB\n\n\nimage1204\u00d71374 151 KB\n\nAnd here are the calculated and simulated values, which match yours  :\n\nimage906\u00d7686 84.6 KB\n", "link": "https://discuss.pennylane.ai//t/codercise-h-6-7-interpreting-the-output-plot/2859/7"}, "7": {"author": "diemilio", "date": "1682436047428", "content": "The only comment I have is that, we do seem to get this term \\left((1+\\frac{t}{2}) U^0 + tU^1 + \\frac{1}{2}t^2 U^2 \\right)|\\psi\\rangle accompanying state |00\\rangle of the auxiliary reg instead of just \\left( U^0 + tU^1 + \\frac{1}{2}t^2 U^2 \\right)|\\psi\\rangle.\nI believe this is the same issue discussed in chapter H.7 of the textbook regarding the unwanted state: \\text{SELECT}|11\\rangle |\\psi\\rangle = |11\\rangle U^0 |\\psi\\rangle, but it does make me wonder if this is why the second approximation is worse than the first, since to be able to perfectly match I + itX - \\frac{1}{2}t^2I, we would need U^0 = \\left(1 + \\frac{t}{2} \\right)^{-1}I, instead of just I, as I had described above.", "link": "https://discuss.pennylane.ai//t/codercise-h-6-7-interpreting-the-output-plot/2859/8"}, "8": {"author": "isaacdevlugt", "date": "1682436114332", "content": "Ah! I see a problem with what\u2019s in the codebook here. Excellent work @diemilio. The circuit diagram for the second-order approximation is not correct. The last control operation should be controlled on all auxiliary wires, like what\u2019s depicted in H.7  :\n\nThe circuit in H.6 only shows U^0 being controlled on the first auxiliary wire, which leads to the presence of an extra U^0 term \u2014 the one with a coefficient of t / 2. So, in your work (excellent notes by the way!) that you attached, in the expression for \\vert \\xi_3 \\rangle you can erase the first U^0.\nHowever, that still doesn\u2019t get rid of that pesky \\frac{t}{2}\u2026 I\u2019ll get back to you! Need to whip out some pen and paper myself.1", "link": "https://discuss.pennylane.ai//t/codercise-h-6-7-interpreting-the-output-plot/2859/9"}, "9": {"author": "isaacdevlugt", "date": "1682708990162", "content": "Hey @diemilio! Just wanted to give a quick update here. I think we may have uncovered more than one issue as a result of your good work here! These things take a little time to double check and re-implement in the codebook. Will keep you updated!", "link": "https://discuss.pennylane.ai//t/codercise-h-6-7-interpreting-the-output-plot/2859/10"}, "10": {"author": "diemilio", "date": "1682782537489", "content": "Thanks so much for letting me know @isaacdevlugt! Also, thanks for being so patient and going over my questions; this discussion has been very informative.\nI will keep my eyes open for the updates to come 1", "link": "https://discuss.pennylane.ai//t/codercise-h-6-7-interpreting-the-output-plot/2859/11"}, "11": {"author": "isaacdevlugt", "date": "1683055767936", "content": "Hey @diemilio! A colleague and I figured out what needs to change in H.6. There are definitely a few errors! It would be a long-winded response if I explained everything here, but the long and short of it is that the circuit for the 2nd-order approximation in H.6 isn\u2019t correct. If you\u2019re interested, we found this video helpful: Optimizing Linear Combination of Unitaries for Quantum Chemistry Hamiltonians - YouTube 3\nWe are working on revamping some of the codercises and the theory in H.6. When those changes are live, I\u2019ll make sure to notify you here.\nExcellent work on exposing this issue! ", "link": "https://discuss.pennylane.ai//t/codercise-h-6-7-interpreting-the-output-plot/2859/12"}, "12": {"author": "diemilio", "date": "1683161621471", "content": "Thanks so much for letting me know and for sending the video, @isaacdevlugt. Looking forward to seeing how the new version of H.6. looks like!1", "link": "https://discuss.pennylane.ai//t/codercise-h-6-7-interpreting-the-output-plot/2859/13"}, "13": {"author": "diemilio", "date": "1683224148720", "content": "Hi @isaacdevlugt, I finally got to watch the video. Thanks again, it clarified things very well.\nNot sure if this is of interest, but I corrected the second-order derivation:\n\nimage1212\u00d71598 226 KB\n\n\nimage1212\u00d71594 167 KB\n\n\nimage1210\u00d7584 40.6 KB\n\nI also ran the sims, and the new expression does get closer to the exact solution. Furthermore, since simulating the third-order approximation required very little changes, I added that one too. As you can see, that trace starts approaching the exact solution very closely:\n\nimage904\u00d7684 92.7 KB\n\nI haven\u2019t found time to derive the third-order approximation, but it shouldn\u2019t be too difficult.\nThanks again for all the feedback, this has been fun!", "link": "https://discuss.pennylane.ai//t/codercise-h-6-7-interpreting-the-output-plot/2859/14"}, "14": {"author": "diemilio", "date": "1683228811421", "content": "Third-order approximation:\n\nimage1208\u00d71110 120 KB\n\n\nimage904\u00d7684 95.8 KB\n", "link": "https://discuss.pennylane.ai//t/codercise-h-6-7-interpreting-the-output-plot/2859/15"}, "15": {"author": "isaacdevlugt", "date": "1683295380924", "content": "Wow! Excellent work! ", "link": "https://discuss.pennylane.ai//t/codercise-h-6-7-interpreting-the-output-plot/2859/16"}, "16": {"author": "isaacdevlugt", "date": "1690992633310", "content": "Hey @diemilio! We\u2019ve finally changed H.6-8 .\n\n\n\ncodebook.xanadu.ai\n\n\n\nXanadu Quantum Codebook 2\nXanadu Quantum Codebook - learn quantum computing interactively online with PennyLane\n\n\n\n\n\nLet us know if you see anything else!", "link": "https://discuss.pennylane.ai//t/codercise-h-6-7-interpreting-the-output-plot/2859/17"}, "17": {"author": "diemilio", "date": "1682110232672", "content": "Thank you so much @isaacdevlugt; makes sense.\nI hope you don\u2019t mind if I ask a couple of more questions.\nI\u2019ve been working on the derivation for the second-order approximation, but I am having a bit of trouble getting it to match my sim results (or even your results).\n\nFrom the textbook, I got the impression that the circuit for the second order approximation would generate a state of the form \\left(U^0 + tU^1 + \\frac{1}{2}t^2 U^2 \\right)|\\psi\\rangle(U0+tU1+12t2U2)|\u03c8\u27e9, up to some normalization factor, but what I actually get is \\left((1+\\frac{t}{2}) U^0 + tU^1 + \\frac{1}{2}t^2 U^2 \\right)|\\psi\\rangle((1+t2)U0+tU1+12t2U2)|\u03c8\u27e9. Is this an error from my part? If not, is there a way to deal with this? Could the presence of this coefficient be the reason why your results for the second-order are worse than the first order?\nSince the second order approximation of e^{itX}eitX is given by:\n\\tilde{U} = I + itX + \\frac{1}{2}(itX)^2~U=I+itX+12(itX)2\n\\tilde{U} = I + itX - \\frac{1}{2}t^2I~U=I+itX\u221212t2I\nin order to match the coefficient of state |\\psi\\rangle|\u03c8\u27e9 with this expression, I would need:\nU^2 = -IU2=\u2212I\nU^1 = iXU1=iX\n U^0 = (1+\\frac{t}{2})^{-1} IU0=(1+t2)\u22121I,\nmaking U^0U0 a non-trivial, non-normalized matrix that depends on tt, which doesn\u2019t seem right . Now, even if I just make U^0 = IU0=I, I still don\u2019t get the same result as you. In that case, my final state (when |00\\rangle|00\u27e9 is measured in the top qubits) would be:\n|\\zeta\\rangle = \\frac{1}{\\sqrt{t^4/4 + t^2 + (t/2+1)^2}} \\left((1+\\frac{t}{2})U^0 + tU^1 + \\frac{1}{2}t^2 U^2 \\right)|\\psi\\rangle |\u03b6\u27e9=1\u221at4/4+t2+(t/2+1)2((1+t2)U0+tU1+12t2U2)|\u03c8\u27e9\n|\\zeta\\rangle = \\frac{1}{\\sqrt{t^4/4 + t^2 + (t/2+1)^2}} \\left((1+\\frac{t}{2})I + itX - \\frac{1}{2}t^2 I \\right)|\\psi\\rangle |\u03b6\u27e9=1\u221at4/4+t2+(t/2+1)2((1+t2)I+itX\u221212t2I)|\u03c8\u27e9\nWhich, for |\\psi\\rangle = |0\\rangle|\u03c8\u27e9=|0\u27e9:\n|\\zeta\\rangle = \\frac{1}{\\sqrt{t^4/4 + t^2 + (t/2+1)^2}} \\left(\\left(-t^2/2 + t/2 + 1 \\right)|0\\rangle + it|1\\rangle\\right) |\u03b6\u27e9=1\u221at4/4+t2+(t/2+1)2((\u2212t2/2+t/2+1)|0\u27e9+it|1\u27e9)\nThe coeff of the |0\\rangle|0\u27e9 would be just this part:\n\\frac{\\left(-t^2/2 + t/2 + 1 \\right)}{\\sqrt{t^4/4 + t^2 + (t/2+1)^2}}(\u2212t2/2+t/2+1)\u221at4/4+t2+(t/2+1)2\nwhich decreases a lot faster than your plot (and my sim for that matter).\n\nAny idea on where I might be going wrong? I can also send the complete derivation if that helps.\nThanks!", "link": "https://discuss.pennylane.ai//t/codercise-h-6-7-interpreting-the-output-plot/2859/18"}, "18": {"author": "isaacdevlugt", "date": "1682347929123", "content": "Hey @diemilio,\nThe second-order approx should definitely be U^0 + tU^1 + \\frac{1}{2}t^2U^2U0+tU1+12t2U2 up to normalization, where the normalization was done before the measurement (measure 0 on both auxiliary qubits), so I\u2019m not 100% certain on where you\u2019ve made a mistake .\nMaybe checking out the original paper will help?\n\n\narxiv.org\n\n\n\n1202.5822.pdf 2\n492.13 KB\n\n\n\n\n\n", "link": "https://discuss.pennylane.ai//t/codercise-h-6-7-interpreting-the-output-plot/2859/19"}, "19": {"author": "diemilio", "date": "1682383066787", "content": "I found my mistake.\nI forgot to add the control to the V_{t/2}Vt/2 and V^\\dagger_{t/2}V\u2020t/2 gates!! \nI will fix that and see if I finally get my results to match.\nEdit: After working on the derivation including the controls for V_{t/2}Vt/2 and V^\\dagger_{t/2}V\u2020t/2, I get the same result. I also just saw from section H.7. of the textbook that this should be in fact the case because V_{t/2}Vt/2 V^\\dagger_{t/2}V\u2020t/2 cancel each other out if they\u2019re not applied, so I am still trying to figure out where I went wrong 1 Reply1", "link": "https://discuss.pennylane.ai//t/codercise-h-6-7-interpreting-the-output-plot/2859/20"}, "20": {"author": "diemilio", "date": "1682434880589", "content": "OK, I FINALLY found my mistake. It was in the normalization. I was assuming that the coefficients of the superpositions were real-valued even after applying U^0U0, U^1U1, U^2U2, which is clearly not the case, so my normalization was wrong.\nHere\u2019s the correct result:\n\nimage1196\u00d71588 187 KB\n\n\nimage1204\u00d71374 151 KB\n\nAnd here are the calculated and simulated values, which match yours  :\n\nimage906\u00d7686 84.6 KB\n", "link": "https://discuss.pennylane.ai//t/codercise-h-6-7-interpreting-the-output-plot/2859/21"}, "21": {"author": "diemilio", "date": "1682436047428", "content": "The only comment I have is that, we do seem to get this term \\left((1+\\frac{t}{2}) U^0 + tU^1 + \\frac{1}{2}t^2 U^2 \\right)|\\psi\\rangle((1+t2)U0+tU1+12t2U2)|\u03c8\u27e9 accompanying state |00\\rangle|00\u27e9 of the auxiliary reg instead of just \\left( U^0 + tU^1 + \\frac{1}{2}t^2 U^2 \\right)|\\psi\\rangle(U0+tU1+12t2U2)|\u03c8\u27e9.\nI believe this is the same issue discussed in chapter H.7 of the textbook regarding the unwanted state: \\text{SELECT}|11\\rangle |\\psi\\rangle = |11\\rangle U^0 |\\psi\\rangleSELECT|11\u27e9|\u03c8\u27e9=|11\u27e9U0|\u03c8\u27e9, but it does make me wonder if this is why the second approximation is worse than the first, since to be able to perfectly match I + itX - \\frac{1}{2}t^2II+itX\u221212t2I, we would need U^0 = \\left(1 + \\frac{t}{2} \\right)^{-1}IU0=(1+t2)\u22121I, instead of just II, as I had described above.", "link": "https://discuss.pennylane.ai//t/codercise-h-6-7-interpreting-the-output-plot/2859/22"}, "22": {"author": "isaacdevlugt", "date": "1682436114332", "content": "Ah! I see a problem with what\u2019s in the codebook here. Excellent work @diemilio. The circuit diagram for the second-order approximation is not correct. The last control operation should be controlled on all auxiliary wires, like what\u2019s depicted in H.7  :\n\nThe circuit in H.6 only shows U^0U0 being controlled on the first auxiliary wire, which leads to the presence of an extra U^0U0 term \u2014 the one with a coefficient of t / 2t/2. So, in your work (excellent notes by the way!) that you attached, in the expression for \\vert \\xi_3 \\rangle|\u03be3\u27e9 you can erase the first U^0U0.\nHowever, that still doesn\u2019t get rid of that pesky \\frac{t}{2}t2\u2026 I\u2019ll get back to you! Need to whip out some pen and paper myself.1", "link": "https://discuss.pennylane.ai//t/codercise-h-6-7-interpreting-the-output-plot/2859/23"}, "23": {"author": "diemilio", "date": "1683228811421", "content": "Third-order approximation:\n\nimage1208\u00d71110 120 KB\n\n\nimage904\u00d7684 95.8 KB\n", "link": "https://discuss.pennylane.ai//t/codercise-h-6-7-interpreting-the-output-plot/2859/24"}, "24": {"author": "isaacdevlugt", "date": "1690992633310", "content": "Hey @diemilio! We\u2019ve finally changed H.6-8 .\n\n\n\ncodebook.xanadu.ai\n\n\n\nXanadu Quantum Codebook 2\nXanadu Quantum Codebook - learn quantum computing interactively online with PennyLane\n\n\n\n\n\nLet us know if you see anything else!", "link": "https://discuss.pennylane.ai//t/codercise-h-6-7-interpreting-the-output-plot/2859/25"}}